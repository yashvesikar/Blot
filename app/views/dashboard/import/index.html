<style>
    
  .imports {border-top:1px solid var(--border-color);margin-top: 24px;padding-top: 24px;display: flex;flex-wrap: wrap;list-style: none;padding: 24px 0 0 0;gap: 1em;max-width: 800px;}
  .imports li {flex-basis: 33%;}
  .imports li a {
    padding:11px 20px;
    color:var(--text-color);
    font-weight: 600;
    display: flex;
    align-items: center;
    font-size: 14px;
    text-decoration: none;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    transition: color 0.25s, background-color 0.25s;
  }
   .imports li a:hover {
    background-color: var(--light-background-color);
    color: var(--accent-color);
   }

   .imports li img {
    max-width: 16px;
    margin-right: 8px;
    height: auto;
   }
  </style>
  
  
  {{> close-button}}

<div style="border:1px solid var(--border-color);border-radius: var(--border-radius);padding:20px">
        <h1>Import</h1>

{{#imports.length}}
<div class="live-updates">
<p><strong>Your imports:</strong></h2>

<style type="text/css">
  .i {border-top:1px solid rgba(0,0,0,0.05);}
  .i:hover {background: rgba(0,0,0,0.02)}
  .i > td form {flex-shrink: 0}

</style>
<table style="max-width: none;table-layout: auto;font-size:14px;">

{{#imports}} 
<tr class="i" id="{{id}}">

  <td class="{{^complete}}{{^error}}working{{/error}}{{/complete}} status">{{name}}</td> 

  <td style="width:100%;color:rgba(0,0,0,0.5)">{{identifier}}</td> 


  {{#complete}}

  {{^error}}
  <td style="padding-right:0"><a href="{{{importBase}}}/download/{{id}}" target="_blank" class="s no-underline" style="display:block;border-radius:4px;white-space: nowrap;padding:4px 11px;text-decoration:none;font-weight: 600;flex-shrink:0;color:#0070e8;border: 1px solid rgba(0,0,0,0.1)">Download result ({{size}} zip)  ↓</a></td>
  {{/error}}
  
  {{#error}}
  <td><span class="error" style="padding:6px 12px;line-height: 1;">{{error}}</span></td>
  {{/error}}

  <td><form  method="post" action="{{{importBase}}}/delete/{{id}}">
    <input type="hidden" name="_csrf" value="{{csrftoken}}">
    <button type="submit" style="display:block;border-radius:4px;white-space: nowrap;padding:6px 11px;text-decoration:none;font-weight: 600;flex-shrink:0;color: #ff3e00;border: 1px solid rgba(0,0,0,0.1);cursor:pointer;background:none;line-height: 1.275;">Remove</button>
  </form></td>
{{/complete}}



{{^complete}}

<td style="width:100%" colspan="2"><span style="color:rgba(0,0,0,0.5)">{{identifier}}</span><span id="status-{{id}}" style="width:100%" class="truncate">{{lastStatus}}</span></td> 


<td>
<form method="post" action="{{{importBase}}}/cancel/{{id}}">
  <input type="hidden" name="_csrf" value="{{csrftoken}}">
  <button type="submit" style="display:block;border-radius:4px;white-space: nowrap;padding:6px 11px;text-decoration:none;font-weight: 600;flex-shrink:0;color: #ff3e00;border: 1px solid rgba(0,0,0,0.1);cursor:pointer;background:none;line-height: 1.275;">Cancel</button>
</form></td>
{{/complete}}
</tr>

{{/imports}} 
</table>
<br>
</div>
{{/imports.length}}

<p style="max-width: 500px">Import data from other apps into Blot.</p>

<ul class="imports">
  <li><a href="{{{importBase}}}/wordpress"><img width="100" height="100" src="/images/configure/wordpress.png"> <span class="a">Wordpress</span></a></li>
  <li><a href="{{{importBase}}}/are.na"><img width="250" height="149" src="/images/configure/are.na.png">  <span class="a">Are.na</span></a></li>
</ul>


<script type="text/javascript">
  // https://www.npmjs.com/package/reconnecting-eventsource
var _ReconnectingEventSource;(()=>{"use strict";var e={19:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceNotAvailableError=void 0;class n extends Error{constructor(){super("EventSource not available.\nConsider loading an EventSource polyfill and making it available globally as EventSource, or passing one in as eventSourceClass to the ReconnectingEventSource constructor.")}}t.EventSourceNotAvailableError=n,t.default=class{constructor(e,t){if(this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this._configuration=null!=t?Object.assign({},t):void 0,this.withCredentials=!1,this._eventSource=null,this._lastEventId=null,this._timer=null,this._listeners={},this.url=e.toString(),this.readyState=this.CONNECTING,this.max_retry_time=3e3,this.eventSourceClass=globalThis.EventSource,null!=this._configuration&&(this._configuration.lastEventId&&(this._lastEventId=this._configuration.lastEventId,delete this._configuration.lastEventId),this._configuration.max_retry_time&&(this.max_retry_time=this._configuration.max_retry_time,delete this._configuration.max_retry_time),this._configuration.eventSourceClass&&(this.eventSourceClass=this._configuration.eventSourceClass,delete this._configuration.eventSourceClass)),null==this.eventSourceClass||"function"!=typeof this.eventSourceClass)throw new n;this._onevent_wrapped=e=>{this._onevent(e)},this._start()}dispatchEvent(e){throw new Error("Method not implemented.")}_start(){let e=this.url;this._lastEventId&&(-1===e.indexOf("?")?e+="?":e+="&",e+="lastEventId="+encodeURIComponent(this._lastEventId)),this._eventSource=new this.eventSourceClass(e,this._configuration),this._eventSource.onopen=e=>{this._onopen(e)},this._eventSource.onerror=e=>{this._onerror(e)},this._eventSource.onmessage=e=>{this.onmessage(e)};for(const e of Object.keys(this._listeners))this._eventSource.addEventListener(e,this._onevent_wrapped)}_onopen(e){0===this.readyState&&(this.readyState=1,this.onopen(e))}_onerror(e){if(1===this.readyState&&(this.readyState=0,this.onerror(e)),this._eventSource&&2===this._eventSource.readyState){this._eventSource.close(),this._eventSource=null;const e=Math.round(this.max_retry_time*Math.random());this._timer=setTimeout((()=>this._start()),e)}}_onevent(e){e instanceof MessageEvent&&(this._lastEventId=e.lastEventId);const t=this._listeners[e.type];if(null!=t)for(const n of[...t])n.call(this,e);"message"===e.type&&this.onmessage(e)}onopen(e){}onerror(e){}onmessage(e){}close(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._eventSource&&(this._eventSource.close(),this._eventSource=null),this.readyState=2}addEventListener(e,t,n){e in this._listeners||(this._listeners[e]=[],null!=this._eventSource&&this._eventSource.addEventListener(e,this._onevent_wrapped));const s=this._listeners[e];Array.isArray(s)&&!s.includes(t)&&s.push(t)}removeEventListener(e,t,n){const s=this._listeners[e];if(null!=s){for(;;){const e=s.indexOf(t);if(-1===e)break;s.splice(e,1)}s.length<=0&&(delete this._listeners[e],null!=this._eventSource&&this._eventSource.removeEventListener(e,this._onevent_wrapped))}}}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0});const t=n(19);Object.assign(window,{ReconnectingEventSource:t.default,EventSourceNotAvailableError:t.EventSourceNotAvailableError})})(),_ReconnectingEventSource=s})();

var evtSource = new ReconnectingEventSource('{{{importBase}}}/status');

var currentlyLoading;
var lastStatus;
var checkAgain;

  
evtSource.onmessage = function (event) {

  const {status, importID} = JSON.parse(event.data);

  var statusContainer = document.getElementById("status-" + importID);
  
  statusContainer.removeAttribute('data-text');
  statusContainer.innerHTML = status;
  truncate(statusContainer);

  if (status === "Finished") {
    // Fetch the latest folder state if we're not
    // already fetching it.
    if (currentlyLoading) {
      checkAgain = true;
      return;
    }

    currentlyLoading = true;

    if (document.querySelector(".live-updates")) loadFolder(function onLoad() {
      if (checkAgain === true) {
        checkAgain = false;
        return loadFolder(onLoad);
      }

      currentlyLoading = false;
    });    
  } 
};

function loadFolder(callback) {
  var xhr = new XMLHttpRequest();

  xhr.onreadystatechange = function (e) {
    if (xhr.readyState == 4 && xhr.status == 200) {
      var parser = new DOMParser();
      var xml = parser.parseFromString(xhr.responseText, "text/html");

      var currentNode = document.querySelector(".live-updates");
      var newNode = xml.querySelector(".live-updates");

      if (currentNode !== null && newNode !== null) {
        var currentState = currentNode.innerHTML;
        var newState = newNode.innerHTML;

        if (newState === currentState) return callback();

        currentNode.innerHTML = newState;
      }

      callback();
    }
  };

  xhr.open("GET", window.location, true);
  xhr.setRequestHeader("Content-type", "text/html");
  xhr.send();
}

</script>

</div>
